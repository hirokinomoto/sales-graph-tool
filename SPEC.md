# SPEC（最小・提出特化版）

## 1. 概要

本ドキュメントは、提出用の最小プロダクトとして「売上CSV → カテゴリ別売上合計の棒グラフ → PNG保存」を実現するTkinterアプリの仕様（正本）である。

- 仕様の正本：本ドキュメント（SPEC.md）
- 決定の正本：決定事項台帳（Excel）

## 2. 目的

売上CSVを読み込み、**カテゴリ別売上合計を棒グラフで可視化し、PNGとして保存**できることを示す（提出用の最小プロダクト）。

## 3. スコープ

### 3.1 今回やること

- CSVファイルを選択して読み込む
- **カテゴリ別売上合計**を算出する
- 棒グラフを生成して画面に表示する
- 生成したグラフを **PNGで保存**できる

### 3.2 スコープ外（今回やらないこと）

- 集計表の画面表示（表/ランキング表示）
- 集計結果CSVの保存
- 日別推移・上位Nなどの複数集計メニュー
- 詳細なデータバリデーション（date形式チェック、amount型チェック、行番号特定など）
- DB連携、ログイン、複数ファイル統合、複雑な分析（統計・予測）

## 4. 想定ユーザー

非エンジニア（例：店舗責任者/マーケ担当）が、カテゴリ別の売上規模をざっくり把握し、**画像として共有**したい。

## 5. 入力（CSV仕様）

### 5.1 ファイル仕様

- 形式：CSV（UTF-8、ヘッダあり）
- 列名固定（必須）：`date`, `category`, `amount`
- 任意列：あっても無視してよい（例：`quantity`）

> 前提：入力CSVは集計に適した状態である（提出用のため）。
> 形式や型の厳密チェックは行わない。

### 5.2 必須列の定義

| 列名     | 意味       | 型（想定）           | 例         | 備考                         |
| -------- | ---------- | -------------------- | ---------- | ---------------------------- |
| date     | 日付       | 文字列（YYYY-MM-DD） | 2026-01-01 | 形式チェックはしない前提     |
| category | カテゴリ名 | 文字列               | Food       | カテゴリ名は任意             |
| amount   | 売上金額   | 数値                 | 12800      | 詳細な型チェックはしない前提 |

## 6. 出力

- 画面：棒グラフ（カテゴリ別売上合計）のみ表示
- 保存：棒グラフを **PNG** で保存

## 7. 画面要件（Tkinter / 1画面完結）

### 7.1 UI要素

**入力エリア**

- [ボタン] CSVを選択
- [表示] 選択したファイルパス
- [ボタン] グラフ作成（実行）

**出力エリア**

- [画像] 棒グラフプレビュー

**保存エリア**

- [ボタン] PNGとして保存

**メッセージエリア**

- [表示] 処理結果メッセージ（成功/失敗）

### 7.2 状態（内部で持つ想定）

- `selected_file`：選択されたCSVファイルパス（未選択ならNone）
- `last_figure`：直近で生成したグラフ（未生成ならNone）

## 8. 最小チェック（失敗時メッセージ）

### 8.1 必須列不足

- 条件：`date, category, amount` のいずれかが存在しない
- 表示：**「必須列が不足しています（date, category, amount）」**
- 挙動：アプリは落ちず、再度CSV選択→実行できる

### 8.2 その他の読み込み/処理失敗

- 条件：読み込みに失敗、処理中に例外が発生、など
- 表示：**「読み込みに失敗しました。CSV形式と列名を確認してください」**
- 挙動：アプリは落ちず、再度CSV選択→実行できる

### 8.3 操作上の未実行（保存前）

- 条件：グラフ未生成の状態で「PNGとして保存」を押下
- 表示：**「先にグラフを作成してください」**

## 9. 操作手順（ユーザーストーリー）

### 9.1 ユーザーストーリー

非エンジニアの担当者として、売上CSVを選んでグラフを作成し、PNG画像として保存して共有したい。

### 9.2 通常フロー

1. アプリを起動する
2. **［CSVを選択］** をクリックする
3. ファイル選択ダイアログで `sample_sales.csv`（または任意の売上CSV）を選ぶ
4. 画面に **選択したファイルパス** が表示される
5. **［グラフ作成］** をクリックする
6. **カテゴリ別売上合計の棒グラフ** が画面に表示される
7. **［PNGとして保存］** をクリックする
8. 保存先とファイル名を指定して保存する
9. 「保存しました」など **成功メッセージ** が表示される

### 9.3 例外フロー

- 必須列不足：メッセージ表示 → 落ちずに再選択可能
- その他失敗：メッセージ表示 → 落ちずに再選択可能

## 10. 処理フロー（擬似フロー図）

### 10.1 画面起動時

- UI部品を生成（ボタン、パス表示、グラフ表示領域、メッセージ領域）
- 状態を初期化（`selected_file=None`, `last_figure=None`）

### 10.2 「CSVを選択」押下

- ファイルダイアログを開く（CSVを対象）
- 選択されたら `selected_file` に保存し、パス表示を更新
- キャンセルなら何もしない

### 10.3 「グラフ作成」押下

1. `selected_file` 未設定なら「CSVを選択してください」→終了
2. CSV読み込み（失敗なら 8.2 のメッセージ→終了）
3. 必須列チェック（不足なら 8.1 のメッセージ→終了）
4. 集計：`category` ごとに `amount` を合計
5. 並び替え：合計売上の降順（見やすさのため）
6. 棒グラフ生成 → 画面表示更新
7. `last_figure` を更新
8. メッセージ「グラフを作成しました」

### 10.4 「PNGとして保存」押下

1. `last_figure` 未生成なら 8.3 のメッセージ→終了
2. 保存ダイアログを開く（png）
3. 保存したら「保存しました」、キャンセルなら何もしない

## 11. 受け入れ条件（完成判定）

- `sample_sales.csv` を読み込み、カテゴリ別合計の棒グラフが表示される
- PNG保存ができ、保存した画像が開ける
- 必須列が欠けたCSVで、アプリが落ちずにエラーメッセージが出る

## 12. 発表用の説明（1文）

売上CSVからカテゴリ別売上を自動集計し、ワンクリックで棒グラフ化して画像保存できるツールです。非エンジニアでも可視化結果をそのまま共有できます。
